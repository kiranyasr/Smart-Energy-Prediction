{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/upload.css') }}">
{% endblock %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<div class="upload-card">
    <h2 style="color:var(--accent-primary);">Energy Data Processor</h2>
    <p>Drag & drop your CSV dataset or click to select a file.</p>
    
    <form method="POST" enctype="multipart/form-data">
        <label for="dataset-upload" class="file-drop-area">
            <i class="fas fa-cloud-upload-alt file-icon"></i>
            <span class="file-msg">Drag & Drop your file here</span>
            <input type="file" id="dataset-upload" name="dataset" accept=".csv" required>
        </label>
        <button type="submit" class="upload-btn">Clean & Process Dataset</button>
    </form>

    {% if preview %}
    <div class="success-message">
        <i class="fas fa-check-circle"></i> Success! Your dataset has been processed.
    </div>
    
    <div class="preview-container">
        {{ preview|safe }}
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('main.download_cleaned', filename=cleaned_file) }}" class="action-btn btn-success">
            <i class="fas fa-download"></i> Download Cleaned
        </a>
        <a href="{{ url_for('main.dashboard') }}" class="action-btn btn-info">
            View Dashboard <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    {% endif %}
</div>

<script>
    const fileInput = document.getElementById('dataset-upload');
    const dropArea = fileInput.closest('.file-drop-area');
    const fileMsg = dropArea.querySelector('.file-msg');

    // Show selected file name
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileMsg.textContent = `Selected file: ${fileInput.files[0].name}`;
        }
    });

    // Drag-over effect
    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('is-dragover');
    });

    // Drag-leave effect
    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('is-dragover');
    });

    // Drop effect
    dropArea.addEventListener('drop', () => {
        dropArea.classList.remove('is-dragover');
    });
</script>

{% endblock %}